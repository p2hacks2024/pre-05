<!-- ...existing code... -->
<!-- トレンドのお店 -->
<div id="trend-name">トレンドのお店</div>

<!-- 店名 -->
<div id="store-names" style="display: none;"></div>

<!-- 画像の位置を指定するCSS -->
<div id="top-left-image">
    <img src="path/to/your/image.jpg" alt="Image">
</div>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

    body {
        font-family: 'Roboto', sans-serif;
        background-color: #000;  /* 背景色を黒に */
        color: #fff;  /* 文字色を白に */
        margin: 0;
        padding: 0;
    }

    #trend-name {
        position: absolute;  /* 絶対位置を指定 */
        top: 150px;  /* 上からの位置を指定 */
        left: 10px;  /* 左からの位置を指定 */
        background-color: #000;  /* 背景色を黒に */
        color: #fff;  /* 文字色を白に */
        padding: 10px 20px;  /* 内側の余白を指定 */
        border-radius: 5px;  /* 角を丸くする */
        border: 2px solid #000;  /* 黒い枠線を追加 */
        box-shadow: 0 4px 8px rgba(255, 255, 255, 0.2);  /* 影を強調 */
        font-size: 18px;  /* フォントサイズを指定 */
        z-index: 1000;  /* 重なり順を指定 */
        cursor: pointer;  /* クリック可能にする */
        transition: background-color 0.3s ease, transform 0.3s ease;  /* 背景色と変形にアニメーションを追加 */
    }

    #trend-name:hover {
        background-color: #ccc;  /* ホバー時の背景色をグレーに */
        color: #000;  /* ホバー時の文字色を黒に */
        transform: scale(1.05);  /* ホバー時に拡大 */
    }

    #store-names {
        position: absolute;  /* 絶対位置を指定 */
        left: 10px;  /* 左からの位置を指定 */
        width: 20%;  /* 画面の幅の1/5に設定 */
        max-height: 70vh;  /* 画面の縦幅の70%を最大高さに設定 */
        overflow-y: auto;  /* 縦方向のスクロールを有効にする */
        background-color: #000;  /* 背景色を黒に */
        color: #fff;  /* 文字色を白に */
        padding: 10px;  /* 内側の余白を指定 */
        border-radius: 5px;  /* 角を丸くする */
        border: 2px solid #000;  /* 黒い枠線を追加 */
        box-shadow: 0 4px 8px rgba(255, 255, 255, 0.2);  /* 影を強調 */
        z-index: 1000;  /* 重なり順を指定 */
        display: none;  /* 初期状態では非表示 */
        word-wrap: break-word;  /* 幅が足りない場合は改行 */
        transition: max-height 0.3s ease;  /* 高さの変化にアニメーションを追加 */
    }

    /* カスタムスクロールバーのスタイル */
    #store-names::-webkit-scrollbar {
        width: 0;  /* スクロールバーの幅を0に設定 */
    }

    .store-name {
        position: relative;  /* 親要素に対して相対的に配置 */
        background-color: #000;  /* 背景色を黒に */
        color: #fff;  /* 文字色を白に */
        padding: 10px;  /* 内側の余白を指定 */
        border-radius: 5px;  /* 角を丸くする */
        border: 2px solid #000;  /* 黒い枠線を追加 */
        box-shadow: 0 2px 4px rgba(255, 255, 255, 0.1);  /* 影を追加 */
        font-size: 16px;  /* フォントサイズを指定 */
        z-index: 1000;  /* 重なり順を指定 */
        margin-top: 10px;  /* 各店舗名の間にスペースを追加 */
        cursor: pointer;  /* クリック可能にする */
        transition: background-color 0.3s ease, transform 0.3s ease;  /* 背景色と変形にアニメーションを追加 */
    }

    .store-name:hover {
        background-color: #ccc;  /* ホバー時の背景色をグレーに */
        color: #000;  /* ホバー時の文字色を黒に */
        transform: translateX(10px);  /* ホバー時に右に移動 */
    }

    .store-name::before {
        content: '🏠';  /* アイコンを追加 */
        margin-right: 10px;  /* アイコンとテキストの間にスペースを追加 */
    }

    /* 画像の位置を指定するCSS */
    #top-left-image {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1000; /* 地図の上に表示するために高い値を設定 */
        width: 100px; /* 画像の幅を指定 */
        height: auto; /* 高さを自動調整 */
        border: 2px solid black; /* 黒い枠線を追加 */
        background-color: black; /* 背景色を黒に設定 */
        border-radius: 50%; /* 丸くする */
        padding: 5px; /* 枠線と画像の間に余白を追加 */
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden; /* 画像が丸の外に出ないようにする */
    }

    #top-left-image img {
        width: 90%; /* 画像の幅を指定 */
        height: auto; /* 高さを自動調整 */
        border-radius: 50%; /* 画像も丸くする */
    }

    #image-container img {
        width: 100%;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    /* クリック後に表示されるUIのスタイル */
    .info-window {
        font-family: 'Arial', sans-serif;
        font-size: 14px;
        line-height: 1.5;
        color: black; /* 文字色を黒に設定 */
        background-color: white; /* 背景色を白に設定 */
        padding: 10px; /* パディングを調整 */
        border-radius: 10px;
        border: 2px solid #000;  /* 黒い枠線を追加 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);  /* 影を強調 */
        max-width: 250px;  /* 幅をコンパクトに */
        position: relative;  /* 相対位置を指定 */
    }

    .info-window h3 {
        margin: 0; /* マージンを削除 */
        padding: 0 0 5px 0; /* 下に少し余白を追加 */
        font-size: 16px;
        color: black; /* 文字色を黒に設定 */
    }

    .info-window p {
        margin: 0; /* マージンを削除 */
        color: black; /* 文字色を黒に設定 */
    }

    .info-window .address {
        font-size: 12px;
        color: black; /* 文字色を黒に設定 */
    }
</style>

<script>
    let map;  // 地図オブジェクトをグローバルに宣言

    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded and parsed');  // デバッグ用ログ

        // JSONデータをパース
        const locations = JSON.parse('{{ fireworks_locations|escapejs }}');
        const storeNamesDiv = document.getElementById('store-names');

        // 各店舗名を追加
        locations.forEach((location) => {
            const storeDiv = document.createElement('div');
            storeDiv.className = 'store-name';
            storeDiv.textContent = location.name;
            storeDiv.dataset.latitude = location.latitude;  // 緯度をデータ属性に追加
            storeDiv.dataset.longitude = location.longitude;  // 経度をデータ属性に追加
            storeNamesDiv.appendChild(storeDiv);

            // 店舗名をクリックしたときに地図をズームアップ
            storeDiv.addEventListener('click', function() {
                const lat = parseFloat(this.dataset.latitude);
                const lng = parseFloat(this.dataset.longitude);
                const position = { lat: lat, lng: lng };
                console.log('Zooming to:', position);  // デバッグ用ログ
                map.setCenter(position);
                map.setZoom(15);  // ズームレベルを設定

                // クリック後に表示されるUIを作成
                const infoWindowContent = `
                    <div class="info-window">
                        <h3>${location.name}</h3>
                        <p>${location.description}</p>
                        <p class="address">${location.address}</p>
                    </div>
                `;
                const infoWindow = new google.maps.InfoWindow({
                    content: infoWindowContent,
                });
                infoWindow.setPosition(position);
                infoWindow.open(map);
            });
        });

        // トレンドボックスをクリックしたときに店舗名を表示
        document.getElementById('trend-name').addEventListener('click', function() {
            const storeNamesDiv = document.getElementById('store-names');
            console.log('Trend box clicked');  // デバッグ用ログ
            if (storeNamesDiv.style.display === 'none') {
                // トレンドボックスの下に位置を設定
                const trendNameRect = document.getElementById('trend-name').getBoundingClientRect();
                storeNamesDiv.style.top = `${trendNameRect.bottom + window.scrollY}px`;
                storeNamesDiv.style.display = 'block';
            } else {
                storeNamesDiv.style.display = 'none';
            }
        });
    });

    window.initMap = function() {
        // fireworks_locationsからデータを取得
        const locations = JSON.parse('{{ fireworks_locations|escapejs }}');
        
        // 最初の店舗の位置を地図の中心に設定
        const initialLocation = {
            lat: locations[0].latitude,
            lng: locations[0].longitude
        };

        // 地図の作成
        map = new google.maps.Map(document.getElementById("map"), {
            center: initialLocation,
            zoom: 12,
            mapTypeId: google.maps.MapTypeId.HYBRID,  // ハイブリッド表示
            mapTypeControl: false,  // 地図タイプの選択タブを非表示
            tilt: 45,  // 角度をつける
        });

        console.log('Map initialized:', map);  // デバッグ用ログ

        // ...remaining existing code...
    };
</script>

<!-- Google Maps JavaScript API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvqWPVxtUSmCUwOnivbYBd9lhlixufhMY&callback=initMap" async defer></script>
<!-- ...existing code... -->
