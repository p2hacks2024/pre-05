<!-- ...existing code... -->
<!-- ãƒˆãƒ¬ãƒ³ãƒ‰ã®ãŠåº— -->
<div id="trend-name">ãƒˆãƒ¬ãƒ³ãƒ‰ã®ãŠåº—</div>

<!-- åº—å -->
<div id="store-names" style="display: none;"></div>

<!-- ç”»åƒã®ä½ç½®ã‚’æŒ‡å®šã™ã‚‹CSS -->
<div id="top-left-image">
    <img src="path/to/your/image.jpg" alt="Image">
</div>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

    body {
        font-family: 'Roboto', sans-serif;
        background-color: #000;  /* èƒŒæ™¯è‰²ã‚’é»’ã« */
        color: #fff;  /* æ–‡å­—è‰²ã‚’ç™½ã« */
        margin: 0;
        padding: 0;
    }

    #trend-name {
        position: absolute;  /* çµ¶å¯¾ä½ç½®ã‚’æŒ‡å®š */
        top: 150px;  /* ä¸Šã‹ã‚‰ã®ä½ç½®ã‚’æŒ‡å®š */
        left: 10px;  /* å·¦ã‹ã‚‰ã®ä½ç½®ã‚’æŒ‡å®š */
        background-color: #000;  /* èƒŒæ™¯è‰²ã‚’é»’ã« */
        color: #fff;  /* æ–‡å­—è‰²ã‚’ç™½ã« */
        padding: 10px 20px;  /* å†…å´ã®ä½™ç™½ã‚’æŒ‡å®š */
        border-radius: 5px;  /* è§’ã‚’ä¸¸ãã™ã‚‹ */
        border: 2px solid #000;  /* é»’ã„æ ç·šã‚’è¿½åŠ  */
        box-shadow: 0 4px 8px rgba(255, 255, 255, 0.2);  /* å½±ã‚’å¼·èª¿ */
        font-size: 18px;  /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        z-index: 1000;  /* é‡ãªã‚Šé †ã‚’æŒ‡å®š */
        cursor: pointer;  /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
        transition: background-color 0.3s ease, transform 0.3s ease;  /* èƒŒæ™¯è‰²ã¨å¤‰å½¢ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  */
    }

    #trend-name:hover {
        background-color: #ccc;  /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰²ã‚’ã‚°ãƒ¬ãƒ¼ã« */
        color: #000;  /* ãƒ›ãƒãƒ¼æ™‚ã®æ–‡å­—è‰²ã‚’é»’ã« */
        transform: scale(1.05);  /* ãƒ›ãƒãƒ¼æ™‚ã«æ‹¡å¤§ */
    }

    #store-names {
        position: absolute;  /* çµ¶å¯¾ä½ç½®ã‚’æŒ‡å®š */
        left: 10px;  /* å·¦ã‹ã‚‰ã®ä½ç½®ã‚’æŒ‡å®š */
        width: 20%;  /* ç”»é¢ã®å¹…ã®1/5ã«è¨­å®š */
        max-height: 70vh;  /* ç”»é¢ã®ç¸¦å¹…ã®70%ã‚’æœ€å¤§é«˜ã•ã«è¨­å®š */
        overflow-y: auto;  /* ç¸¦æ–¹å‘ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹ */
        background-color: #000;  /* èƒŒæ™¯è‰²ã‚’é»’ã« */
        color: #fff;  /* æ–‡å­—è‰²ã‚’ç™½ã« */
        padding: 10px;  /* å†…å´ã®ä½™ç™½ã‚’æŒ‡å®š */
        border-radius: 5px;  /* è§’ã‚’ä¸¸ãã™ã‚‹ */
        border: 2px solid #000;  /* é»’ã„æ ç·šã‚’è¿½åŠ  */
        box-shadow: 0 4px 8px rgba(255, 255, 255, 0.2);  /* å½±ã‚’å¼·èª¿ */
        z-index: 1000;  /* é‡ãªã‚Šé †ã‚’æŒ‡å®š */
        display: none;  /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
        word-wrap: break-word;  /* å¹…ãŒè¶³ã‚Šãªã„å ´åˆã¯æ”¹è¡Œ */
        transition: max-height 0.3s ease;  /* é«˜ã•ã®å¤‰åŒ–ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  */
    }

    /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #store-names::-webkit-scrollbar {
        width: 0;  /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®å¹…ã‚’0ã«è¨­å®š */
    }

    .store-name {
        position: relative;  /* è¦ªè¦ç´ ã«å¯¾ã—ã¦ç›¸å¯¾çš„ã«é…ç½® */
        background-color: #000;  /* èƒŒæ™¯è‰²ã‚’é»’ã« */
        color: #fff;  /* æ–‡å­—è‰²ã‚’ç™½ã« */
        padding: 10px;  /* å†…å´ã®ä½™ç™½ã‚’æŒ‡å®š */
        border-radius: 5px;  /* è§’ã‚’ä¸¸ãã™ã‚‹ */
        border: 2px solid #000;  /* é»’ã„æ ç·šã‚’è¿½åŠ  */
        box-shadow: 0 2px 4px rgba(255, 255, 255, 0.1);  /* å½±ã‚’è¿½åŠ  */
        font-size: 16px;  /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’æŒ‡å®š */
        z-index: 1000;  /* é‡ãªã‚Šé †ã‚’æŒ‡å®š */
        margin-top: 10px;  /* å„åº—èˆ—åã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’è¿½åŠ  */
        cursor: pointer;  /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
        transition: background-color 0.3s ease, transform 0.3s ease;  /* èƒŒæ™¯è‰²ã¨å¤‰å½¢ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  */
    }

    .store-name:hover {
        background-color: #ccc;  /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰²ã‚’ã‚°ãƒ¬ãƒ¼ã« */
        color: #000;  /* ãƒ›ãƒãƒ¼æ™‚ã®æ–‡å­—è‰²ã‚’é»’ã« */
        transform: translateX(10px);  /* ãƒ›ãƒãƒ¼æ™‚ã«å³ã«ç§»å‹• */
    }

    .store-name::before {
        content: 'ğŸ ';  /* ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ  */
        margin-right: 10px;  /* ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ†ã‚­ã‚¹ãƒˆã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’è¿½åŠ  */
    }

    /* ç”»åƒã®ä½ç½®ã‚’æŒ‡å®šã™ã‚‹CSS */
    #top-left-image {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1000; /* åœ°å›³ã®ä¸Šã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã«é«˜ã„å€¤ã‚’è¨­å®š */
        width: 100px; /* ç”»åƒã®å¹…ã‚’æŒ‡å®š */
        height: auto; /* é«˜ã•ã‚’è‡ªå‹•èª¿æ•´ */
        border: 2px solid black; /* é»’ã„æ ç·šã‚’è¿½åŠ  */
        background-color: black; /* èƒŒæ™¯è‰²ã‚’é»’ã«è¨­å®š */
        border-radius: 50%; /* ä¸¸ãã™ã‚‹ */
        padding: 5px; /* æ ç·šã¨ç”»åƒã®é–“ã«ä½™ç™½ã‚’è¿½åŠ  */
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden; /* ç”»åƒãŒä¸¸ã®å¤–ã«å‡ºãªã„ã‚ˆã†ã«ã™ã‚‹ */
    }

    #top-left-image img {
        width: 90%; /* ç”»åƒã®å¹…ã‚’æŒ‡å®š */
        height: auto; /* é«˜ã•ã‚’è‡ªå‹•èª¿æ•´ */
        border-radius: 50%; /* ç”»åƒã‚‚ä¸¸ãã™ã‚‹ */
    }

    #image-container img {
        width: 100%;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    /* ã‚¯ãƒªãƒƒã‚¯å¾Œã«è¡¨ç¤ºã•ã‚Œã‚‹UIã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .info-window {
        font-family: 'Arial', sans-serif;
        font-size: 14px;
        line-height: 1.5;
        color: black; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
        background-color: white; /* èƒŒæ™¯è‰²ã‚’ç™½ã«è¨­å®š */
        padding: 10px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
        border-radius: 10px;
        border: 2px solid #000;  /* é»’ã„æ ç·šã‚’è¿½åŠ  */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);  /* å½±ã‚’å¼·èª¿ */
        max-width: 250px;  /* å¹…ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
        position: relative;  /* ç›¸å¯¾ä½ç½®ã‚’æŒ‡å®š */
    }

    .info-window h3 {
        margin: 0; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’å‰Šé™¤ */
        padding: 0 0 5px 0; /* ä¸‹ã«å°‘ã—ä½™ç™½ã‚’è¿½åŠ  */
        font-size: 16px;
        color: black; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
    }

    .info-window p {
        margin: 0; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’å‰Šé™¤ */
        color: black; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
    }

    .info-window .address {
        font-size: 12px;
        color: black; /* æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
    }
</style>

<script>
    let map;  // åœ°å›³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å®£è¨€

    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded and parsed');  // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°

        // JSONãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹
        const locations = JSON.parse('{{ fireworks_locations|escapejs }}');
        const storeNamesDiv = document.getElementById('store-names');

        // å„åº—èˆ—åã‚’è¿½åŠ 
        locations.forEach((location) => {
            const storeDiv = document.createElement('div');
            storeDiv.className = 'store-name';
            storeDiv.textContent = location.name;
            storeDiv.dataset.latitude = location.latitude;  // ç·¯åº¦ã‚’ãƒ‡ãƒ¼ã‚¿å±æ€§ã«è¿½åŠ 
            storeDiv.dataset.longitude = location.longitude;  // çµŒåº¦ã‚’ãƒ‡ãƒ¼ã‚¿å±æ€§ã«è¿½åŠ 
            storeNamesDiv.appendChild(storeDiv);

            // åº—èˆ—åã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«åœ°å›³ã‚’ã‚ºãƒ¼ãƒ ã‚¢ãƒƒãƒ—
            storeDiv.addEventListener('click', function() {
                const lat = parseFloat(this.dataset.latitude);
                const lng = parseFloat(this.dataset.longitude);
                const position = { lat: lat, lng: lng };
                console.log('Zooming to:', position);  // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°
                map.setCenter(position);
                map.setZoom(15);  // ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®š

                // ã‚¯ãƒªãƒƒã‚¯å¾Œã«è¡¨ç¤ºã•ã‚Œã‚‹UIã‚’ä½œæˆ
                const infoWindowContent = `
                    <div class="info-window">
                        <h3>${location.name}</h3>
                        <p>${location.description}</p>
                        <p class="address">${location.address}</p>
                    </div>
                `;
                const infoWindow = new google.maps.InfoWindow({
                    content: infoWindowContent,
                });
                infoWindow.setPosition(position);
                infoWindow.open(map);
            });
        });

        // ãƒˆãƒ¬ãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«åº—èˆ—åã‚’è¡¨ç¤º
        document.getElementById('trend-name').addEventListener('click', function() {
            const storeNamesDiv = document.getElementById('store-names');
            console.log('Trend box clicked');  // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°
            if (storeNamesDiv.style.display === 'none') {
                // ãƒˆãƒ¬ãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã®ä¸‹ã«ä½ç½®ã‚’è¨­å®š
                const trendNameRect = document.getElementById('trend-name').getBoundingClientRect();
                storeNamesDiv.style.top = `${trendNameRect.bottom + window.scrollY}px`;
                storeNamesDiv.style.display = 'block';
            } else {
                storeNamesDiv.style.display = 'none';
            }
        });
    });

    window.initMap = function() {
        // fireworks_locationsã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const locations = JSON.parse('{{ fireworks_locations|escapejs }}');
        
        // æœ€åˆã®åº—èˆ—ã®ä½ç½®ã‚’åœ°å›³ã®ä¸­å¿ƒã«è¨­å®š
        const initialLocation = {
            lat: locations[0].latitude,
            lng: locations[0].longitude
        };

        // åœ°å›³ã®ä½œæˆ
        map = new google.maps.Map(document.getElementById("map"), {
            center: initialLocation,
            zoom: 12,
            mapTypeId: google.maps.MapTypeId.HYBRID,  // ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰è¡¨ç¤º
            mapTypeControl: false,  // åœ°å›³ã‚¿ã‚¤ãƒ—ã®é¸æŠã‚¿ãƒ–ã‚’éè¡¨ç¤º
            tilt: 45,  // è§’åº¦ã‚’ã¤ã‘ã‚‹
        });

        console.log('Map initialized:', map);  // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°

        // ...remaining existing code...
    };
</script>

<!-- Google Maps JavaScript API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvqWPVxtUSmCUwOnivbYBd9lhlixufhMY&callback=initMap" async defer></script>
<!-- ...existing code... -->
